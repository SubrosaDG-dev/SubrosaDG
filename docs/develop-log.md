## SubrosaDG Project Develop Log

### 2023-10-13

1. 目前项目整体已经完成gmsh网格读取(三角四边混合网格),积分信息的获取与存储,二维Euler方程的计算以及进行高阶重构后的tecplot输出.无粘格式采用Roe格式,时间推进实现了前向Euler以及三阶SSP Runta-Kutta.

2. 目前存在的问题主要有在物面边界条件下三角网格计算不正确,会出现负压力,初步debug后感觉疑似是在进行局部质量矩阵与残差相乘后过大导致负压力,但是在全远场的情况下计算本身非常稳定,这至少保证了体积分和面积分本身的计算过程是没有问题的.在四边形作为物面边界进行计算时能保持稳定,但是如果扰动传播到三角网格后云图上还是能发现一些非物理的现象.

3. 在后处理过程中进行的高阶结果重构效果并不理想,表现为云图上出现规律性的波动,这种波动本身是和流场无关的,在那些地方很明显应该是连续且平滑的.虽然这里采用的是相邻点平均的算法,但是理论上DG的结果应该是能在一个单元内本身就保持一定的单调性的.目前怀疑有可能和上面的问题同源,但不排除是这样的重构方法本身从理论上就不可行,因为也没有检索到这样操作的文献.如果是后者,要么就抛弃高阶重构的方法,要么就只能去找寻一个更加适合DG的后处理格式.

4. 整套基于C++的非类型模版参数的静态分发系统过于复杂,这个会增加后续维护的难度,目前这个架构并不适合继续改动,需要等到后续完成到三维的NS方程后根据明确的需求进行整体的架构设计,可以使用纯数据结构加依赖注入的模式,这可以使用C++的CRTP来很轻松的实现.

5. 对于目前发生的计算不准确的问题大概率并不来源于代码编写,更大概率是由于对于本身算法理解不到位导致的.因此接下来可能不会继续debug,而是更多的考虑验证一下目前为止推出的公式以及验证DG空间离散部分的细节,后续可以等交叉验证的结果.

6. 现在无粘通量格式本身只实现了Roe格式,接下来考虑实现LF和HLLC格式,通量格式这一部分本身和计算代码解耦,因此可以单独实现.

7. 边界条件上,现在使用的亚音速远场边界条件本身是不正确的.如果物面表面导致的扰动在到达边界前并没有耗散完的话,这个边界条件会导致扰动反射回来,因此其本身是不满足物理的.正确的做法应该是使用无反射边界条件,并且区分亚音速和超音速,这个可以用边界处的法向Mach数进行判断.还有就是绝热物面边界,这里有很多种形式,有使用dummy节点的,有直接给出物面上的物理量的,还有直接算出边界上通量大小的,这几种方法是否等价还需要理论验证.

### 2023-10-30

1. 就物面边界处三角网格计算异常的问题这里猜测可能是由于物面边界处单元的物理阶数与计算阶数不匹配导致,这里尝试使用新的也就是四边形绕流算例来测试.但其实这首先不能解释四边形网格计算导致的棋盘形波动,其次对于原来的圆柱绕流你本身也可以将其看成一个多面体绕流计算,因此这仅仅作为一个猜测,这里会使用纯三角网格来计算测试.

2. 对于猜测的局部质量矩阵的异常,目前可以选取某一个特定的单元与解析结果进行比较,这里可以用一套特定的测试网格来进行手动计算,这样可以验证局部质量矩阵的计算是否正确.

3. 对于曲面单元的高阶重构这个问题,应该是必须要解决的问题,目前主要的问题是如何处理第一层网格拉伸后导致后面几层网格也需要拉伸的问题,这里涉及到内部网格,仅使用边界条件是无法解决的.这里应该不会考虑放弃gmsh,手动实现一个网格软件的难度太大.

### 2023-11-06

1. 目前对于局部质量矩阵的计算已经进行了验证,这里使用的是一个三角形网格,并且使用了一个特定的测试网格来进行手动计算,这里的结果是一致的,因此可以排除局部质量矩阵的计算错误.

2. 对于上面一直在寻找的bug(三角形计算的不稳定问题以及后处理的高阶重构结果异常是同源的问题),目前应该是已经找到了答案,这里的问题出现在了两个地方.

3. 首先是在面积分的地方,对于单元边这个东西,为了保证一条边的唯一性,这里在做网格的拓扑信息重建的时候一条边是只被索引一次的,那么这条边在左单元上的顺序是正向,在右单元上的方向就是负向.这很好理解,因为我们需要保证全局单元的逆时针顺序.这件事情在正常的有限体积法中并不会出现问题,但是对于DG的面积分,我们其实是需要严格遵守顺序的(也就是说在对边上其实积分点的顺序是倒着的),因为这涉及重构出来的在面上的守恒量的值是否正确.如果这里不正确,那么计算的面通量的值就是错误的,这表现出来的结果就是左右单元的用来计算通量的积分点被反转.在圆柱绕流问题中就会表现出一种奇特的周向绕流,尽管这一部分应该是没有的.这里的解决方法就是在计算面积分的时候,对于右单元上的积分点的顺序进行反转,这样就能保证左右单元上的积分点的顺序是一致的.

4. 在解决了上述问题以后,发现对于内部单元,计算已经没有问题,但是在三角形作为壁面单元的时候,计算结果仍然会很快发散,并且在壁面处仍会出现上面一致的周向绕流.这里后来发现是在gmsh生成高阶网格时,自动对于高阶网格进行了曲面化,这个弯曲单元仅限壁面一层,因此也只有壁面出现了问题,这里解决方式是在生成网格时开启gmsh里的Mesh.SecondOrderLinear,这样就能保证高阶网格不会被曲面化.

5. 解决上述两个问题后,圆柱绕流问题已经能够正常计算了,并且在后处理的高阶重构结果也是正确的,这里的正确性是指在云图上不会出现棋盘形的波动,并且在物面处的结果也是正确的.但是naca0012的计算会很快发散,这里排查出来应该是网格的问题,目前按照gmsh文档生成的naca0012混合网格在翼根处做了圆形过渡,这会导致翼根处有一个竖向单元,这个单元会引起一个很严重的扰动,在我们目前代码没加限制器的情况下,这个扰动会很快传播到整个网格,导致计算发散.这里的解决方法是在生成网格时,将翼根处的圆形过渡去掉,用正常的尖角连接.

6. 目前主要工作中心会放在代码重构上,至于具体的重构思路还没有想好,但是应该是会将现在的代码进行一次大的重构.
